# F4HWN-R7

> firmware port for the UV-K1 and UV-K5 V3 using the PY32F071 MCU

1. 基于F4HWN固件，添加仿R7的页面。请切换分支 `motorola_r7` 进行编译

### 主界面示意

![2fb58fa8f1b8b5cdc7ee2cb509e1a471](https://github.com/user-attachments/assets/11312942-a8bf-45d2-85cf-ca22ca00b13e)


## 主页面 (MAIN ONLY) 元素说明

### 如何进入主页面

- **主页面**即开机或从菜单退出后默认显示的收发界面（非菜单、非扫描等）。
- 若要使用带计时与仿 R7 布局的**单 VFO 主界面**，需在菜单中开启 **MAIN ONLY**：
  1. 按 **Menu** 键进入菜单；
  2. 选择**第 53 项「RxMode」**（界面显示为 RX MODE）；
  3. 在 RxMode 子项中选择 **MAIN ONLY** 并确认；
  4. 退出菜单后，即显示单 VFO 主界面（双守、跨段关闭）。
- 开启 MAIN ONLY 后，每次回到主界面都会显示该布局；再次进入 **菜单 → 第 53 项 RxMode** 选择其它选项可关闭并恢复原有双显等逻辑。

### 界面元素

在单 VFO 主界面下，屏幕自上而下包含以下元素：

- **顶线**  
  屏幕最上方一条横线，位于菜单栏下方。

- **左侧小长条 + 方框**  
  - 左侧 7 像素宽小长条与右侧大方框共边、同高（y=2～33）。  
  - **RX 接收时**：小长条为空心边框；**非接收时**（发射、待机等）：小长条为实心黑块。  
  - 方框由上、右、下三条边围成（左边与小长条重合）。

- **方框内第一行**  
  - **右侧**：当前灵敏度 **dBm**（最小字）。  
  - **信道模式 (MR)** 时，在频率区域右上角显示 **信道号**（4 位，最小字、黑底白字反色），高度不超出频率顶部。

- **方框内第二行**  
  - **信道模式**：**信道名**（左对齐，小号字）。  
  - **频率模式 (VFO)**：在信道名位置显示 **VFO**（左对齐）。

- **方框内第三行**  
  - **频率**：主段大号数字 + 后两位小字，左对齐、同一行显示。**正常接收时显示接收频率，发射时显示发射频率。**

- **方框下方两行**（右对齐，最小字）  
  - **第一行**：`time: MM:SS` 计时（分:秒，需 `ENABLE_FEAT_F4HWN_RX_TX_TIMER`）。  
  - **第二行**：亚音信息（R/T CT 或 DCS，类型与数值紧挨无空格）。

- **底部两按钮**  
  - 左钮：**Menu**；右钮：当前**调制模式**（如 FM、AM）。  
  - 黑底白字（反色），中间 1 像素白线分隔；黑底在文字上方多 1 像素黑线，使文字视觉居中。

## 计时如何开启

主页面方框下第一行的 **`time: MM:SS`**（分:秒）收发计时由编译选项 **`ENABLE_FEAT_F4HWN_RX_TX_TIMER`** 控制：

- **使用默认 CMake 预设**：`CMakePresets.json` 里默认预设已把 `ENABLE_FEAT_F4HWN_RX_TX_TIMER` 设为 `true`，直接按文档编译即可，计时会显示。
- **手动配置 CMake 时**：若未用预设或想单独开关，在配置时加上：
  ```bash
  -DENABLE_FEAT_F4HWN_RX_TX_TIMER=ON
  ```
  例如：
  ```bash
  cmake -B build -DENABLE_FEAT_F4HWN_RX_TX_TIMER=ON ...
  ```
- **关闭计时**：配置时设为 `OFF` 或不在 cacheVariables 里启用即可，主页面该行不再显示计时。

**计时显示与逻辑**

- **显示格式**：分:秒（`MM:SS`）。
- **发射 (TX)**：按下 PTT 时按菜单 TOT 重新开始倒计时，显示剩余时间；松开 PTT 停止；再次按 PTT 重新倒计时。到 0 超时断开发射。
- **接收 (RX)**：与系统原逻辑一致。切换信道（或 VFO）时重置为 00:00:00；在接收状态下正计时。
